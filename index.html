<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendário Letivo 2026 - Visualização</title>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <!-- NOVO: Container para logomarca e título -->
    <div id="header-container">
      <div id="logo-container">
        <!-- Logomarca será carregada aqui via JavaScript -->
        <img
          id="school-logo"
          src=""
          alt="Logomarca da Escola"
          style="display: none"
        />
      </div>
      <div id="title-container">
        <h1 id="main-title">Calendário Letivo 2026 - Visualização</h1>
        <div
          id="school-name"
          style="
            display: none;
            margin-top: 5px;
            font-size: 1.1rem;
            color: var(--gray-600);
          "
        >
          <!-- Nome da escola será inserido aqui -->
        </div>
      </div>
    </div>

    <div id="totals">
      <h2>Ano Letivo 2026</h2>

      <div class="total-display">
        <div>
          <div class="total-main" id="totalAnoAtual">0</div>
          <div class="total-label">dias letivos de 200</div>
        </div>

        <div class="total-progress">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="progress-text" id="progressText">0%</div>
        </div>
      </div>

      <div class="info-cards">
        <div class="info-card" id="inicioAnoLetivo">
          <strong>Início</strong>
          <span>09 de Fevereiro 2026</span>
        </div>
        <div class="info-card" id="fimAnoLetivo">
          <strong>Fim</strong>
          <span>Não definido</span>
        </div>
      </div>
    </div>

    <!-- NOVA SEÇÃO: Legenda das Cores -->
    <div
      id="colorLegend"
      style="
        background: white;
        padding: 24px;
        border-radius: var(--border-radius);
        margin-bottom: 30px;
        box-shadow: var(--shadow);
        border: 1px solid var(--gray-200);
        max-width: 1400px;
        margin-left: auto;
        margin-right: auto;
      "
    >
      <h2
        style="
          margin: 0 0 20px 0;
          font-size: 0.95rem;
          color: var(--gray-600);
          font-weight: 500;
          text-transform: uppercase;
          letter-spacing: 0.05em;
          display: flex;
          align-items: center;
          gap: 10px;
        "
      >
        <span
          style="
            content: '';
            width: 5px;
            height: 18px;
            background: var(--primary);
            border-radius: 2px;
          "
        ></span>
        Legenda das Cores
      </h2>

      <div
        id="legendItems"
        style="
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
          gap: 12px;
        "
      >
        <!-- As legendas serão inseridas aqui via JavaScript -->
      </div>

      <div
        style="
          margin-top: 20px;
          padding-top: 15px;
          border-top: 1px solid var(--gray-200);
          font-size: 0.9rem;
          color: var(--gray-500);
        "
      >
        <p>
          <strong>Observação:</strong> As cores podem ser personalizadas pelo
          editor. Esta legenda mostra as cores atualmente em uso no calendário.
        </p>
      </div>
    </div>

    <div id="buttons">
      <div class="button-row">
        <button id="exportPDF">Exportar PDF</button>
        <button id="goToEditor">Acessar Editor (Requer Senha)</button>
      </div>
    </div>

    <div id="yearCalendar"></div>

    <!-- Modal de visualização do mês em tamanho grande -->
    <div id="monthViewModal" class="modal">
      <div
        class="modal-content"
        style="
          width: 90%;
          max-width: 1200px;
          max-height: 90vh;
          overflow-y: auto;
        "
      >
        <span id="closeMonthViewModal" class="close">&times;</span>
        <h2 id="monthViewTitle"></h2>

        <div
          id="monthViewDescription"
          style="
            margin-bottom: 20px;
            padding: 15px;
            background: var(--gray-50);
            border-radius: 8px;
          "
        ></div>

        <div
          id="monthViewGrid"
          style="
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--gray-200);
            padding: 1px;
          "
        >
          <!-- Os dias serão inseridos aqui via JavaScript -->
        </div>

        <div
          style="
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--gray-200);
          "
        >
          <div
            id="monthViewNotes"
            style="font-size: 0.9rem; color: var(--gray-600)"
          ></div>
          <div
            id="monthViewTarget"
            style="font-size: 0.9rem; color: var(--gray-600); margin-top: 10px"
          ></div>
        </div>

        <div class="modal-actions" style="margin-top: 20px">
          <button id="printMonthView">Imprimir Visualização</button>
        </div>
      </div>
    </div>

    <!-- Firebase SDKs (Compat) -->
    <!-- Substitua o conteúdo de FIREBASE_CONFIG no próximo bloco pelo seu config do Firebase (veja o passo a passo). -->
    <script>
      // ---------- CONFIGURE AQUI ----------
      // Troque o objeto abaixo pelo seu FIREBASE_CONFIG fornecido no console do Firebase
      const FIREBASE_CONFIG = {
        apiKey: "AIzaSyBoJ0fleRy89A5m43Giu-M17qbbTSOYopk",
        authDomain: "calendario-letivo-6c027.firebaseapp.com",
        projectId: "calendario-letivo-6c027",
        storageBucket: "calendario-letivo-6c027.firebasestorage.app",
        messagingSenderId: "953319249148",
        appId: "1:953319249148:web:f35074ab1303131187b379",
      };
      window.FIREBASE_CONFIG = FIREBASE_CONFIG;

      // NOVO: Configuração da Escola
      // Modifique estas variáveis para personalizar para cada escola
      const SCHOOL_CONFIG = {
        name: "EEMTI Filgueiras Lima", // Altere para o nome da escola
        logo: "logo.png", // Nome do arquivo da logo (logo.png ou logo.jpg)
        logoAlt: "Logomarca da Escola", // Texto alternativo para acessibilidade
        showInPDF: true, // Se true, a logo aparecerá no PDF exportado
      };
      window.SCHOOL_CONFIG = SCHOOL_CONFIG;
    </script>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <!-- Bibliotecas para gerar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script src="script.js"></script>
    <script>
      // Configuração específica para a página de visualização
      document.addEventListener("DOMContentLoaded", async function () {
        // Inicializar Firebase (se configurado)
        if (
          window.FIREBASE_CONFIG &&
          Object.keys(window.FIREBASE_CONFIG).length
        ) {
          initFirebase(); // function injected by script.js
        }

        // NOVO: Carregar logomarca da escola
        loadSchoolLogo();

        // Inicializar calendário em modo somente leitura
        editMode = false;
        await initCalendar();

        // Configurar botão para ir ao editor
        document
          .getElementById("goToEditor")
          .addEventListener("click", function () {
            window.location.href = "editor.html";
          });

        // Configurar botão de exportar PDF
        document
          .getElementById("exportPDF")
          .addEventListener("click", function () {
            generatePDF();
          });

        // Configurar botão de imprimir visualização do mês
        document
          .getElementById("printMonthView")
          .addEventListener("click", function () {
            window.print();
          });

        // Fechar modal ao clicar fora
        window.addEventListener("click", function (event) {
          const monthViewModal = document.getElementById("monthViewModal");
          if (event.target === monthViewModal) {
            monthViewModal.style.display = "none";
          }
        });

        // Fechar modal com botão X
        document
          .getElementById("closeMonthViewModal")
          .addEventListener("click", function () {
            document.getElementById("monthViewModal").style.display = "none";
          });
      });

      // NOVA FUNÇÃO: Carregar logomarca da escola
      function loadSchoolLogo() {
        const schoolConfig = window.SCHOOL_CONFIG || {};
        const logoElement = document.getElementById("school-logo");
        const schoolNameElement = document.getElementById("school-name");
        const mainTitleElement = document.getElementById("main-title");

        // Configurar nome da escola se fornecido
        if (schoolConfig.name && schoolConfig.name !== "Nome da Escola") {
          schoolNameElement.textContent = schoolConfig.name;
          schoolNameElement.style.display = "block";

          // Atualizar título principal para incluir nome da escola
          if (mainTitleElement) {
            mainTitleElement.textContent = `Calendário Letivo 2026 - ${schoolConfig.name}`;
          }
        }

        // Tentar carregar a logomarca
        if (
          schoolConfig.logo &&
          (schoolConfig.logo === "logo.png" || schoolConfig.logo === "logo.jpg")
        ) {
          logoElement.src = schoolConfig.logo;
          logoElement.alt = schoolConfig.logoAlt || "Logomarca da Escola";

          // Quando a imagem carregar, mostrar e ajustar estilos
          logoElement.onload = function () {
            logoElement.style.display = "block";
            logoElement.style.maxHeight = "80px";
            logoElement.style.maxWidth = "200px";
            logoElement.style.objectFit = "contain";
            logoElement.style.marginRight = "20px";
          };

          // Se a imagem não carregar, tentar alternativas
          logoElement.onerror = function () {
            console.warn(
              `Logomarca "${schoolConfig.logo}" não encontrada. Tentando alternativas...`
            );

            // Tentar com diferentes extensões
            const alternativeExtensions = ["png", "jpg", "jpeg", "svg", "webp"];
            const baseName = schoolConfig.logo.split(".")[0];

            let tryCount = 0;
            const tryNextLogo = () => {
              if (tryCount < alternativeExtensions.length) {
                const altLogo = `${baseName}.${alternativeExtensions[tryCount]}`;
                logoElement.src = altLogo;
                tryCount++;
              } else {
                console.warn(
                  "Nenhuma logomarca encontrada. Usando layout sem logo."
                );
                logoElement.style.display = "none";
              }
            };

            logoElement.onerror = tryNextLogo;
            tryNextLogo();
          };
        } else {
          // Se não houver configuração de logo, esconder o container
          document.getElementById("logo-container").style.display = "none";
        }
      }
    </script>
  </body>
</html>
