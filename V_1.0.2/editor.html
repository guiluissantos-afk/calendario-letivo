<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendário Letivo 2025/2026 - Editor</title>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <!-- Tela de login (aparece primeiro) -->
    <div
      id="loginScreen"
      style="
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      "
    >
      <div class="modal-content" style="width: 400px">
        <h2>Acesso ao Editor</h2>
        <p style="margin-bottom: 20px; color: var(--gray-600)">
          Digite a senha para acessar o modo de edição:
        </p>

        <label for="editorPassword">Senha:</label>
        <input
          type="password"
          id="editorPassword"
          placeholder="Digite a senha"
          style="margin-bottom: 15px"
        />

        <div class="modal-actions">
          <button id="loginButton">Entrar</button>
          <button id="backButton" onclick="window.location.href='index.html'">
            Voltar para Visualização
          </button>
        </div>

        <p
          id="loginError"
          style="color: var(--danger); margin-top: 15px; display: none"
        >
          Senha incorreta. Tente novamente.
        </p>

        <p style="font-size: 0.8rem; color: var(--gray-500); margin-top: 20px">
          Senha padrão: admin123<br />
          (Você pode alterar no arquivo auth.js)
        </p>
      </div>
    </div>

    <!-- Conteúdo do editor (aparece após login) -->
    <div id="editorContent" style="display: none">
      <h1>Calendário Letivo 2025/2026 - Editor</h1>

      <div id="totals">
        <h2>Ano Letivo 2026</h2>

        <div class="total-display">
          <div>
            <div class="total-main" id="totalAnoAtual">0</div>
            <div class="total-label">dias letivos de 200</div>
          </div>

          <div class="total-progress">
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">0%</div>
          </div>
        </div>

        <div class="info-cards">
          <div class="info-card" id="inicioAnoLetivo">
            <strong>Início</strong>
            <span>09 de Fevereiro 2026</span>
          </div>
          <div class="info-card" id="fimAnoLetivo">
            <strong>Fim</strong>
            <span>Não definido</span>
          </div>
        </div>
      </div>

      <div id="buttons">
        <div class="button-row">
          <button id="toggleEditMode">Ativar Modo de Edição</button>
          <button id="resetCalendar">Resetar</button>
          <button id="exportJSON">Exportar JSON</button>
          <button id="importJSON">Importar JSON</button>
          <button id="exportPDF">Exportar PDF</button>
          <button id="goToViewer">Voltar para Visualização</button>
          <button id="logoutButton">Sair do Editor</button>
          <input type="file" id="jsonFileInput" style="display: none" />
        </div>
      </div>

      <div id="editModeIndicator">Modo de Edição Ativo</div>

      <div id="yearCalendar"></div>

      <!-- Modal de edição do dia -->
      <div id="dayModal" class="modal">
        <div class="modal-content">
          <span id="closeDayModal" class="close">&times;</span>
          <h2 id="modalDayTitle"></h2>

          <label>Tipo do dia:</label>
          <select id="dayType">
            <option value="comum">Dia Letivo</option>
            <option value="evento">Evento Escolar</option>
            <option value="avaliacao">Avaliação</option>
            <option value="sabado_letivo">Sábado Letivo</option>
            <option value="feriado">Feriado</option>
            <option value="recesso">Recesso (Todos os funcionários)</option>
            <option value="recesso_professores">Recesso dos Professores</option>
            <option value="ferias">Férias</option>
            <option value="paralisacao">Paralisação</option>
            <option value="recuperacao">Recuperação Final</option>
          </select>

          <label>Título:</label>
          <input type="text" id="dayTitle" />

          <label>Descrição:</label>
          <textarea id="dayDescription"></textarea>

          <div class="modal-actions">
            <button id="setPeriodStart">Definir Início do Período</button>
            <button id="setPeriodEnd">Definir Fim do Período</button>
          </div>

          <div class="modal-actions">
            <button id="saveDay">Salvar</button>
            <button id="deleteDay" class="danger">Apagar Evento</button>
          </div>
        </div>
      </div>

      <!-- Modal de edição do mês -->
      <div id="monthModal" class="modal">
        <div class="modal-content">
          <span id="closeMonthModal" class="close">&times;</span>
          <h2 id="modalMonthTitle"></h2>

          <label>Nome do mês:</label>
          <input type="text" id="monthName" />

          <label>Descrição:</label>
          <textarea id="monthDesc"></textarea>

          <label>Observações:</label>
          <textarea id="monthNotes"></textarea>

          <label>Meta de dias letivos:</label>
          <input type="number" id="monthTarget" />

          <div class="modal-actions">
            <button id="saveMonth">Salvar Mês</button>
          </div>
        </div>
      </div>

      <!-- Modal de visualização do mês em tamanho grande -->
      <div id="monthViewModal" class="modal">
        <div
          class="modal-content"
          style="
            width: 90%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
          "
        >
          <span id="closeMonthViewModal" class="close">&times;</span>
          <h2 id="monthViewTitle"></h2>

          <div
            id="monthViewDescription"
            style="
              margin-bottom: 20px;
              padding: 15px;
              background: var(--gray-50);
              border-radius: 8px;
            "
          ></div>

          <div
            id="monthViewGrid"
            style="
              display: grid;
              grid-template-columns: repeat(7, 1fr);
              gap: 1px;
              background: var(--gray-200);
              padding: 1px;
            "
          >
            <!-- Os dias serão inseridos aqui via JavaScript -->
          </div>

          <div
            style="
              margin-top: 20px;
              padding-top: 15px;
              border-top: 1px solid var(--gray-200);
            "
          >
            <div
              id="monthViewNotes"
              style="font-size: 0.9rem; color: var(--gray-600)"
            ></div>
            <div
              id="monthViewTarget"
              style="
                font-size: 0.9rem;
                color: var(--gray-600);
                margin-top: 10px;
              "
            ></div>
          </div>

          <div class="modal-actions" style="margin-top: 20px">
            <button id="printMonthView">Imprimir Visualização</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Firebase SDKs (Compat) -->
    <script>
      // ---------- CONFIGURE AQUI ----------
      // Cole aqui o mesmo FIREBASE_CONFIG do index.html
      const FIREBASE_CONFIG = {
        apiKey: "AIzaSyBoJ0fleRy89A5m43Giu-M17qbbTSOYopk",
        authDomain: "calendario-letivo-6c027.firebaseapp.com",
        projectId: "calendario-letivo-6c027",
        storageBucket: "calendario-letivo-6c027.firebasestorage.app",
        messagingSenderId: "953319249148",
        appId: "1:953319249148:web:f35074ab1303131187b379",
      };
      window.FIREBASE_CONFIG = FIREBASE_CONFIG;
    </script>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <!-- Biblioteca jsPDF e html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script src="script.js"></script>
    <script src="auth.js"></script>
    <script>
      // Configuração específica para a página de editor
      document.addEventListener("DOMContentLoaded", async function () {
        // Inicializar Firebase (se configurado)
        if (
          window.FIREBASE_CONFIG &&
          Object.keys(window.FIREBASE_CONFIG).length
        ) {
          initFirebase(); // function from script.js
        }

        // SEMPRE mostrar tela de login primeiro
        document.getElementById("loginScreen").style.display = "flex";
        document.getElementById("editorContent").style.display = "none";

        // Configurar botão de login
        document
          .getElementById("loginButton")
          .addEventListener("click", function () {
            const password = document.getElementById("editorPassword").value;
            const errorElement = document.getElementById("loginError");

            if (checkPassword(password)) {
              // Salvar login apenas para esta sessão
              saveLogin();
              showEditor();
            } else {
              errorElement.style.display = "block";
              document.getElementById("editorPassword").value = "";
              document.getElementById("editorPassword").focus();
            }
          });

        // Permitir login com Enter
        document
          .getElementById("editorPassword")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              document.getElementById("loginButton").click();
            }
          });

        // Botão para voltar à visualização
        document
          .getElementById("goToViewer")
          .addEventListener("click", function () {
            // Não fazer logout, apenas redirecionar
            window.location.href = "index.html";
          });

        // Botão para sair do editor (logout)
        document
          .getElementById("logoutButton")
          .addEventListener("click", function () {
            if (confirm("Deseja realmente sair do modo de edição?")) {
              logout();
            }
          });

        // Configurar botão de imprimir visualização do mês
        document
          .getElementById("printMonthView")
          .addEventListener("click", function () {
            window.print();
          });

        // Fechar modais ao clicar fora
        window.addEventListener("click", function (event) {
          const dayModal = document.getElementById("dayModal");
          const monthModal = document.getElementById("monthModal");
          const monthViewModal = document.getElementById("monthViewModal");

          if (event.target === dayModal) {
            dayModal.style.display = "none";
          }
          if (event.target === monthModal) {
            monthModal.style.display = "none";
          }
          if (event.target === monthViewModal) {
            monthViewModal.style.display = "none";
          }
        });
      });

      function showEditor() {
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("editorContent").style.display = "block";

        // Inicializar calendário em modo de edição
        editMode = true;
        initCalendar();

        // Ativar indicador de modo de edição
        const indicator = document.getElementById("editModeIndicator");
        indicator.classList.add("active");
        indicator.innerHTML =
          "✏️ MODO DE EDIÇÃO ATIVO - Clique nos dias para editar";

        // Configurar botão de alternar modo
        const toggleBtn = document.getElementById("toggleEditMode");
        toggleBtn.textContent = "Desativar Modo de Edição";

        // Configurar sessão (para logout automático após tempo)
        setupSession();
      }
    </script>
  </body>
</html>
